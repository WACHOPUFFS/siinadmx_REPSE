<ion-content [fullscreen]="true" class="ion-padding">
  <!-- Breadcrumbs -->
  <ion-breadcrumbs>
    <ion-breadcrumb routerLink="/home">Inicio</ion-breadcrumb>
    <ion-breadcrumb routerLink="/confirm-week">Confirmación de Días</ion-breadcrumb>
  </ion-breadcrumbs>

    <!-- Botón de retroceso -->
    <div class="back-button mt-3" (click)="goBack()">
      <ion-icon name="arrow-back"></ion-icon>
    </div>
  

  <!-- Título de la Página -->
  <div class="container mt-4">
    <div class="d-flex justify-content-center mb-4">
      <h5><strong>Confirmación de Días</strong></h5>
    </div>

    <!-- Resumen de la Semana -->
    <div class="row">
      <!-- Columna izquierda para mostrar información de la semana -->
      <div class="col-lg-4 col-md-5">
        <div class="sticky-top p-3 mb-4 bg-light rounded shadow-sm">
          <h6 class="fw-bold">Resumen de la Semana</h6>
          <p><strong>Fecha seleccionada:</strong> {{ currentFecha || 'No seleccionada' }}</p>
          <p><strong>Semana:</strong> {{ currentSemana || 'No disponible' }}</p>
          <p><strong>Inicio del Periodo:</strong> {{ periodStartDate || 'No disponible' }}</p>
          <p><strong>Fin del Periodo:</strong> {{ periodEndDate || 'No disponible' }}</p>
          <!-- Lista de Días de la Semana -->
          <div class="mt-3 ">
            <h6><strong>Días de la semana:</strong></h6>
          </div>
          <div class="days-container mt-3">
            <div *ngFor="let dia of diasSemana" class="day-box" [ngClass]="{
                   'confirmed': dia.status === 'confirmed', 
                   'pending': dia.status === 'pending'
                 }" (click)="mostrarInfoDia(dia)">
              {{ dia.date | date:'dd' }}
            </div>
          </div>
        </div>
      </div>

      <!-- Columna derecha con detalles de empleados por día -->
      <div class="col-lg-8 col-md-7">
        <ion-searchbar [(ngModel)]="searchTerm" (ionInput)="filterEmployees()" placeholder="Buscar empleados..."></ion-searchbar>
        <!-- Lista de Empleados Asignados -->
        <div class="card shadow-lg p-4 mb-4">
          <div class="card-body">
            <h6>Empleados Asignados para el Día Seleccionado</h6>
            <ion-list>
              <ion-item *ngFor="let emp of filteredEmpleadosDia">
                <ion-label>
                  <h6 class="fw-bold">{{ emp.employee_code }} - {{ emp.first_name }} {{ emp.last_name }} {{
                    emp.middle_name }}</h6>
                  <p><small>Obra: {{ emp.project_name }}</small></p>
                  <p><small>Estado: {{ emp.project_status }}</small></p>

                  <!-- Mostrar información de incidencia si existe -->
                  <div *ngIf="emp.hasIncidencia">
                    <p><small>Tipo de Incidencia: {{ emp.incident_type || 'N/A' }}</small></p>
                    <p><small>Descripción: {{ emp.description || 'N/A' }}</small></p>
                  </div>
                </ion-label>
                <ion-button color="danger" slot="end" [disabled]="selectedDia?.status === 'confirmed'"
                  (click)="eliminarEmpleadoDelDia(emp.employee_id)">
                  Eliminar
                </ion-button>
              </ion-item>
            </ion-list>
          </div>
        </div>

        <!-- Lista de Empleados solo con Incidencias (sin asignación) -->
        <div class="card shadow-lg p-4 mb-4" *ngIf="filteredEmpleadosIncidencias.length > 0">
          <div class="card-body">
            <h6>Empleados con Incidencias para el Día Seleccionado (Sin Asignación)</h6>
            <ion-list>
              <ion-item *ngFor="let emp of filteredEmpleadosIncidencias">
                <ion-label>
                  <h6 class="fw-bold">{{ emp.employee_code }} - {{ emp.first_name }} {{ emp.last_name }} {{
                    emp.middle_name }}</h6>
                  <p><small>Tipo de Incidencia: {{ emp.incident_type || 'N/A' }}</small></p>
                  <p><small>Descripción: {{ emp.description || 'N/A' }}</small></p>
                  <p><small>Fecha: {{ emp.created_at | date: 'dd/MM/yyyy' }}</small></p>
                </ion-label>
                <ion-button color="danger" slot="end" [disabled]="selectedDia?.status === 'confirmed'"
                  (click)="eliminarEmpleadoDelDia(emp.employee_id)">
                  Eliminar
                </ion-button>
              </ion-item>
            </ion-list>
          </div>
        </div>

        <div class="d-flex justify-content-end mt-3">
          <ion-button *ngIf="selectedDia" expand="full" color="primary" [disabled]="selectedDia?.status === 'confirmed'"
            (click)="confirmarDia(selectedDia)">
            Confirmar Día
          </ion-button>
        </div>

      </div>
    </div>
  </div>
</ion-content>

